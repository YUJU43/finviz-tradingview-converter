<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•€ë¹„ì¦ˆ â†’ íŠ¸ë ˆì´ë”©ë·° ë³€í™˜ê¸° Pro</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { margin: 0; font-family: Arial, sans-serif; }
        * { box-sizing: border-box; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        const FinvizToTradingViewConverter = () => {
            const [csvData, setCsvData] = useState(null);
            const [convertedData, setConvertedData] = useState([]);
            const [isProcessing, setIsProcessing] = useState(false);
            const [message, setMessage] = useState('');
            const [isDetecting, setIsDetecting] = useState(false);

            // í™•ì¥ëœ ê±°ë˜ì†Œ ë°ì´í„°ë² ì´ìŠ¤
            const exchangeDatabase = {
                NYSE: [
                    'AER', 'AMZN', 'BAC', 'BAM', 'BE', 'BEN', 'BROS', 'BTSG', 'CARR', 'CBRL', 'CG', 
                    'CRDO', 'CRMD', 'CUZ', 'DAN', 'DASH', 'DIS', 'F', 'GE', 'GM', 'JPM', 'KO', 
                    'MCD', 'NKE', 'PFE', 'T', 'V', 'WMT', 'XOM', 'BABA', 'TSM', 'NIO', 'PDD',
                    'JNJ', 'UNH', 'HD', 'PG', 'CVX', 'LLY', 'ABBV', 'TMO', 'ACN', 'COST',
                    'DHR', 'VZ', 'ADBE', 'TXN', 'NFLX', 'CRM', 'WFC', 'IBM', 'GS', 'MS',
                    'BA', 'CAT', 'MMM', 'HON', 'RTX', 'LOW', 'UPS', 'SPGI', 'BLK', 'AXP'
                ],
                NASDAQ: [
                    'AAPL', 'MSFT', 'GOOGL', 'GOOG', 'NVDA', 'TSLA', 'META', 'AMGN', 'PYPL',
                    'CMCSA', 'INTC', 'CSCO', 'ADBE', 'NFLX', 'CRM', 'QCOM', 'TXN', 'INTU',
                    'AMAT', 'ISRG', 'BKNG', 'GILD', 'ADP', 'VRTX', 'FISV', 'MDLZ', 'REGN',
                    'ATVI', 'CSX', 'ILMN', 'MRVL', 'LRCX', 'EXC', 'ORLY', 'DXCM', 'CTAS'
                ]
            };

            // APIë¥¼ í†µí•œ ê±°ë˜ì†Œ ìë™ ê°ì§€
            const detectExchangeFromAPI = async (ticker) => {
                await new Promise(resolve => setTimeout(resolve, 50)); // ì‹œë®¬ë ˆì´ì…˜ ë”œë ˆì´
                
                if (exchangeDatabase.NYSE.includes(ticker)) return 'NYSE';
                if (exchangeDatabase.NASDAQ.includes(ticker)) return 'NASDAQ';
                
                // ê¸°ë³¸ê°’: ì•ŒíŒŒë²³ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” 3-4ìë¦¬ëŠ” ëŒ€ë¶€ë¶„ NASDAQ
                if (ticker.length <= 4 && /^[A-Z]+$/.test(ticker)) return 'NASDAQ';
                return 'NYSE';
            };

            const handleFileUpload = (event) => {
                const file = event.target.files[0];
                if (!file) return;

                if (!file.name.toLowerCase().endsWith('.csv')) {
                    setMessage('âŒ CSV íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                    return;
                }

                setIsProcessing(true);
                setMessage('â³ íŒŒì¼ ì²˜ë¦¬ ì¤‘...');

                const reader = new FileReader();
                reader.onload = async (e) => {
                    try {
                        const text = e.target.result;
                        const lines = text.split('\n').filter(line => line.trim());
                        
                        if (lines.length < 2) {
                            setMessage('âŒ CSV íŒŒì¼ì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                            setIsProcessing(false);
                            return;
                        }

                        const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
                        
                        const tickerIndex = headers.findIndex(header => 
                            ['ticker', 'symbol', 'Ticker', 'Symbol', 'TICKER', 'SYMBOL'].includes(header)
                        );

                        if (tickerIndex === -1) {
                            setMessage('âŒ í‹°ì»¤(Ticker) ì»¬ëŸ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                            setIsProcessing(false);
                            return;
                        }

                        const stocks = [];
                        setMessage('ğŸ” ê±°ë˜ì†Œ ìë™ ê°ì§€ ì¤‘...');
                        setIsDetecting(true);

                        for (let i = 1; i < lines.length; i++) {
                            const columns = [];
                            let current = '';
                            let inQuotes = false;
                            
                            // CSV íŒŒì‹±
                            for (let j = 0; j < lines[i].length; j++) {
                                const char = lines[i][j];
                                if (char === '"') {
                                    inQuotes = !inQuotes;
                                } else if (char === ',' && !inQuotes) {
                                    columns.push(current.trim());
                                    current = '';
                                } else {
                                    current += char;