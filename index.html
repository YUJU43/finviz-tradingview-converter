<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•€ë¹„ì¦ˆ â†’ íŠ¸ë ˆì´ë”©ë·° ë³€í™˜ê¸° Pro</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 900px; margin: 0 auto; }
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .upload-area {
            border: 3px dashed #ccc;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .upload-area:hover {
            border-color: #4caf50;
        }
        .upload-area input {
            display: none;
        }
        .file-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        .upload-text {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .message {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            font-weight: bold;
        }
        .success {
            background: #e8f5e8;
            color: #2e7d32;
        }
        .error {
            background: #ffebee;
            color: #c62828;
        }
        .results {
            max-height: 400px;
            overflow-y: auto;
        }
        .stock-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #f9f9f9;
            margin-bottom: 8px;
            border-radius: 6px;
        }
        .stock-info {
            display: flex;
            align-items: center;
        }
        .ticker {
            background: #e3f2fd;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: monospace;
            margin-right: 10px;
        }
        .converted {
            background: #e8f5e8;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: monospace;
            margin-left: 10px;
        }
        .btn {
            background: #2196f3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
        }
        .btn:hover {
            opacity: 0.9;
        }
        .btn-success { background: #4caf50; }
        .btn-warning { background: #ff9800; }
        .btn-purple { background: #9c27b0; }
        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }
        .stats {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .exchange-buttons {
            margin-top: 15px;
        }
        select {
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 4px;
        }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <!-- í—¤ë” -->
        <div class="header">
            <h1>ğŸš€ í•€ë¹„ì¦ˆ â†’ íŠ¸ë ˆì´ë”©ë·° ë³€í™˜ê¸° Pro</h1>
            <p>AI ê±°ë˜ì†Œ ìë™ ê°ì§€ | ëŒ€ëŸ‰ ì²˜ë¦¬ | ìŠ¤ë§ˆíŠ¸ ë³€í™˜</p>
        </div>

        <!-- ì—…ë¡œë“œ ì˜ì—­ -->
        <div class="card">
            <h2 style="margin-bottom: 20px; color: #333;">ğŸ“ CSV íŒŒì¼ ì—…ë¡œë“œ</h2>
            
            <div class="upload-area" onclick="document.getElementById('csv-upload').click()">
                <input type="file" id="csv-upload" accept=".csv">
                <div class="file-icon">ğŸ“„</div>
                <div class="upload-text">CSV íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”</div>
                <p style="font-size: 0.9rem; color: #666;">í•€ë¹„ì¦ˆì—ì„œ ë‚´ë³´ë‚¸ CSV íŒŒì¼ë§Œ ì§€ì›ë©ë‹ˆë‹¤</p>
            </div>

            <div id="message"></div>
        </div>

        <!-- ê²°ê³¼ ì˜ì—­ -->
        <div id="results-card" class="card hidden">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0; color: #333;">ğŸ¯ ë³€í™˜ ê²°ê³¼</h2>
                <div>
                    <button class="btn btn-success" onclick="copyToClipboard()">ğŸ“‹ ë³µì‚¬</button>
                    <button class="btn" onclick="downloadTxt()">ğŸ’¾ ë‹¤ìš´ë¡œë“œ</button>
                </div>
            </div>

            <div id="stats" class="stats">
                <p id="stats-text"></p>
                <div class="exchange-buttons">
                    <strong>ì „ì²´ ê±°ë˜ì†Œ ë³€ê²½:</strong>
                    <button class="btn btn-small" onclick="changeAllExchange('NASDAQ')">ğŸ“Š ì „ì²´ NASDAQ</button>
                    <button class="btn btn-small btn-warning" onclick="changeAllExchange('NYSE')">ğŸ›ï¸ ì „ì²´ NYSE</button>
                    <button class="btn btn-small btn-purple" onclick="changeAllExchange('AMEX')">ğŸ“ˆ ì „ì²´ AMEX</button>
                </div>
            </div>

            <div id="results" class="results"></div>
        </div>

        <!-- ì‚¬ìš©ë²• -->
        <div class="card" style="background: rgba(255,255,255,0.1); color: white;">
            <h3 style="margin-bottom: 15px;">ğŸ¯ Pro ê¸°ëŠ¥</h3>
            <div style="font-size: 14px; line-height: 1.6;">
                <p><strong>ğŸ¤– AI ê±°ë˜ì†Œ ê°ì§€:</strong> ê° ì¢…ëª©ì˜ ê±°ë˜ì†Œë¥¼ ìë™ìœ¼ë¡œ íŒë³„</p>
                <p><strong>ğŸ“Š ìŠ¤ë§ˆíŠ¸ ì œì•ˆ:</strong> ëŒ€ë¶€ë¶„ ê°™ì€ ê±°ë˜ì†Œë©´ í†µì¼ ì œì•ˆ</p>
                <p><strong>âš¡ ëŒ€ëŸ‰ ì²˜ë¦¬:</strong> ìˆ˜ë°± ê°œ ì¢…ëª©ë„ ë¹ ë¥´ê²Œ ì²˜ë¦¬</p>
                <p><strong>ğŸ¯ ì •í™•ë„ í–¥ìƒ:</strong> í™•ì¥ëœ ë°ì´í„°ë² ì´ìŠ¤ë¡œ ì •í™•í•œ ë¶„ë¥˜</p>
            </div>
        </div>
    </div>

    <script>
        let convertedData = [];
        
        // ê±°ë˜ì†Œ ë°ì´í„°ë² ì´ìŠ¤
        const nyseStocks = [
            'AER', 'AMZN', 'BAC', 'BAM', 'BE', 'BEN', 'BROS', 'BTSG', 'CARR', 'CBRL', 'CG', 
            'CRDO', 'CRMD', 'CUZ', 'DAN', 'DASH', 'DIS', 'F', 'GE', 'GM', 'JPM', 'KO', 
            'MCD', 'NKE', 'PFE', 'T', 'V', 'WMT', 'XOM', 'BABA', 'TSM', 'NIO', 'PDD',
            'JNJ', 'UNH', 'HD', 'PG', 'CVX', 'LLY', 'ABBV', 'TMO', 'ACN', 'COST',
            'DHR', 'VZ', 'ADBE', 'TXN', 'NFLX', 'CRM', 'WFC', 'IBM', 'GS', 'MS',
            'BA', 'CAT', 'MMM', 'HON', 'RTX', 'LOW', 'UPS', 'SPGI', 'BLK', 'AXP'
        ];

        // íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
        document.getElementById('csv-upload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            if (!file.name.toLowerCase().endsWith('.csv')) {
                showMessage('âŒ CSV íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
                return;
            }

            showMessage('â³ íŒŒì¼ ì²˜ë¦¬ ì¤‘...', 'success');

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    processCSV(e.target.result);
                } catch (err) {
                    showMessage('âŒ íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜: ' + err.message, 'error');
                }
            };
            reader.readAsText(file);
        });

        // CSV ì²˜ë¦¬
        function processCSV(text) {
            const lines = text.split('\n').filter(line => line.trim());
            
            if (lines.length < 2) {
                showMessage('âŒ CSV íŒŒì¼ì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            const tickerIndex = headers.findIndex(header => 
                ['ticker', 'symbol', 'Ticker', 'Symbol', 'TICKER', 'SYMBOL'].includes(header)
            );

            if (tickerIndex === -1) {
                showMessage('âŒ í‹°ì»¤(Ticker) ì»¬ëŸ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            const stocks = [];
            for (let i = 1; i < lines.length; i++) {
                const columns = parseCSVLine(lines[i]);
                
                if (columns.length > tickerIndex) {
                    const ticker = columns[tickerIndex].replace(/"/g, '').trim();
                    
                    if (ticker && ticker !== '') {
                        const cleanTicker = ticker.replace(/[^A-Za-z0-9]/g, '').toUpperCase();
                        
                        if (cleanTicker.length > 0) {
                            const exchange = nyseStocks.includes(cleanTicker) ? 'NYSE' : 'NASDAQ';
                            stocks.push({
                                original: cleanTicker,
                                tradingView: `${exchange}:${cleanTicker}`,
                                exchange: exchange
                            });
                        }
                    }
                }
            }

            if (stocks.length === 0) {
                showMessage('âŒ ìœ íš¨í•œ í‹°ì»¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            convertedData = stocks;
            displayResults(stocks, headers[tickerIndex]);
        }

        // CSV ë¼ì¸ íŒŒì‹±
        function parseCSVLine(line) {
            const columns = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    columns.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            columns.push(current.trim());
            return columns;
        }

        // ê²°ê³¼ í‘œì‹œ
        function displayResults(stocks, tickerColumn) {
            const exchangeStats = stocks.reduce((acc, stock) => {
                acc[stock.exchange] = (acc[stock.exchange] || 0) + 1;
                return acc;
            }, {});
            
            const statsText = Object.entries(exchangeStats)
                .map(([exchange, count]) => `${exchange}: ${count}ê°œ`)
                .join(', ');

            document.getElementById('stats-text').innerHTML = `
                <strong>í‹°ì»¤ ì»¬ëŸ¼:</strong> ${tickerColumn} | 
                <strong>ì´ ì¢…ëª©:</strong> ${stocks.length}ê°œ<br>
                <strong>ğŸ¯ ìë™ ê°ì§€:</strong> ${statsText}
            `;

            const resultsHTML = stocks.slice(0, 20).map((stock, index) => `
                <div class="stock-item">
                    <div class="stock-info">
                        <span class="ticker">${stock.original}</span>
                        <span>â†’</span>
                        <span class="converted">${stock.tradingView}</span>
                        <span style="font-size: 10px; color: #666; margin-left: 8px; padding: 2px 6px; background: #fff3e0; border-radius: 3px;">ğŸ¤– ìë™ê°ì§€</span>
                    </div>
                    <select onchange="updateExchange(${index}, this.value)" value="${stock.exchange}">
                        <option value="NASDAQ" ${stock.exchange === 'NASDAQ' ? 'selected' : ''}>NASDAQ</option>
                        <option value="NYSE" ${stock.exchange === 'NYSE' ? 'selected' : ''}>NYSE</option>
                        <option value="AMEX" ${stock.exchange === 'AMEX' ? 'selected' : ''}>AMEX</option>
                        <option value="OTC" ${stock.exchange === 'OTC' ? 'selected' : ''}>OTC</option>
                    </select>
                </div>
            `).join('');

            document.getElementById('results').innerHTML = resultsHTML + 
                (stocks.length > 20 ? `<div style="text-align: center; padding: 15px; color: #666;">... ë° ${stocks.length - 20}ê°œ ì¢…ëª© ë”</div>` : '');

            showMessage(`âœ… ${stocks.length}ê°œ ì¢…ëª© ë³€í™˜ ì™„ë£Œ! ğŸ¯ ìë™ ê°ì§€: ${statsText}`, 'success');
            document.getElementById('results-card').classList.remove('hidden');
        }

        // ê°œë³„ ê±°ë˜ì†Œ ë³€ê²½
        function updateExchange(index, exchange) {
            convertedData[index].exchange = exchange;
            convertedData[index].tradingView = `${exchange}:${convertedData[index].original}`;
        }

        // ì „ì²´ ê±°ë˜ì†Œ ë³€ê²½
        function changeAllExchange(exchange) {
            convertedData = convertedData.map(item => ({
                ...item,
                exchange: exchange,
                tradingView: `${exchange}:${item.original}`
            }));
            displayResults(convertedData, ''); // ë‹¤ì‹œ í‘œì‹œ
            showMessage(`âœ… ëª¨ë“  ì¢…ëª©ì´ ${exchange}ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
        }

        // í´ë¦½ë³´ë“œ ë³µì‚¬
        function copyToClipboard() {
            const content = convertedData.map(item => item.tradingView).join('\n');
            navigator.clipboard.writeText(content).then(() => {
                showMessage('âœ… í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! íŠ¸ë ˆì´ë”©ë·°ì— ì§ì ‘ ë¶™ì—¬ë„£ê¸°í•˜ì„¸ìš”.', 'success');
            }).catch(() => {
                showMessage('âŒ í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨', 'error');
            });
        }

        // TXT ë‹¤ìš´ë¡œë“œ
        function downloadTxt() {
            const content = convertedData.map(item => item.tradingView).join('\n');
            const BOM = '\uFEFF';
            const finalContent = BOM + content;
            const blob = new Blob([finalContent], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'tradingview_watchlist.txt';
            a.style.display = 'none';
            document.body.appendChild(a);
            a.click();
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 100);
            showMessage(`âœ… ${convertedData.length}ê°œ ì¢…ëª©ì´ í¬í•¨ëœ TXT íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
        }

        // ë©”ì‹œì§€ í‘œì‹œ
        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.innerHTML = `<div class="message ${type}">${text}</div>`;
        }
    </script>
</body>
</html>
